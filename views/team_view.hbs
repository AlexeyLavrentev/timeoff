
{{> header }}

<h1>{{t "teamView.title"}}</h1>

<div class="row">
  <div class="col-md-6 lead">{{t "teamView.teamLabel" name=(concatenate logged_user.name " " logged_user.lastname)}} <a href="/calendar/feeds/" data-toggle="tooltip" data-placement="right" title="{{t 'teamView.exportTitle'}}"><span class="fa fa-rss"></span></a></div>
  <div class="col-md-3 col-md-offset-3">
    <div class="btn-group btn-group-sm pull-right" role="group">
      <a href="/calendar/teamview/?{{> team_view_url_parameters grouped_mode = 0 save_grouped_mode = 1 save_current_department = 1 }}" class="btn btn-default" {{#unless grouped_mode}}disabled=disabled{{/unless}}>{{t "teamView.all"}}</a>
      <a href="/calendar/teamview/?{{> team_view_url_parameters grouped_mode = 1 save_grouped_mode = 1 save_current_department = 1 }}" class="btn btn-default" {{#if grouped_mode}}disabled=disabled{{/if}}>{{t "teamView.byDepartment"}}</a>
    </div>
  </div>
</div>

{{> show_flash_messages }}

<div class="row">&nbsp;</div>

<nav>
  <div class="row">
    <div class="col-xs-2">
      <a class="btn btn-link btn-lg" href="/calendar/teamview/?{{> team_view_url_parameters base_date = prev_date }}"><span aria-hidden="true" class="fa fa-chevron-left"></span> {{as_date_formatted prev_date 'MMM' }}</a>
    </div>

    <div class="col-xs-8 calendar-section-caption">
        <button id="team_view_month_select_btn" class="btn btn-link btn-lg" data-tom="/calendar/teamview/?{{> team_view_url_parameters base_date=0 }}" data-provide="datepicker" data-date-format="yyyy-mm" data-date-autoclose="1" data-date-min-view-mode="months">
          {{#if_equal months_count 1}}
            {{as_date_formatted base_date 'MMMM, YYYY' }}
          {{else}}
            {{as_date_formatted start_date 'MMM'}} - {{as_date_formatted end_date 'MMM, YYYY' }}
          {{/if_equal}}
          <i class="fa fa-angle-down"></i>
        </button>
    </div>

    <div class="col-xs-2">
      <a class="btn btn-link btn-lg pull-right" href="/calendar/teamview/?{{> team_view_url_parameters base_date = next_date }}">{{as_date_formatted next_date 'MMM'}} <span aria-hidden="true" class="fa fa-chevron-right"></span></a>
    </div>
  </div>
</nav>

<div class="row">&nbsp;</div>

<div class="row team-view-filters">
  <div class="col-md-4">
    <div class="form-group">
      <label class="control-label">{{t "teamView.departmentLabel"}}</label>
      <div class="dropdown">
        <button class="btn btn-default dropdown-toggle left-column-cell" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
          {{#if current_department }}{{current_department.name}}{{else}}{{t "teamView.allDepartments"}}{{/if}}
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
          <li><a href="?{{> team_view_url_parameters current_department = null save_current_department = 1 }}">{{t "teamView.allDepartments"}}</a></li>
          <li role="separator" class="divider"></li>
          {{#each related_departments}}
          <li><a href="?{{> team_view_url_parameters base_date = ../base_date current_department = this save_current_department = 1 }}">{{this.name}}</a></li>
          {{/each}}
        </ul>
      </div>
    </div>
    {{#if logged_user.admin}}
      <div class="form-group">
        <label class="control-label">{{t "teamView.groupLabel"}}</label>
        <div class="dropdown">
          <button class="btn btn-default dropdown-toggle left-column-cell" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            {{#if current_group }}{{current_group.name}}{{else}}{{t "teamView.allGroups"}}{{/if}}
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
            <li><a href="?{{> team_view_url_parameters current_group = null save_current_group = 1 }}">{{t "teamView.allGroups"}}</a></li>
            <li role="separator" class="divider"></li>
            {{#each related_groups}}
            <li><a href="?{{> team_view_url_parameters base_date = ../base_date current_group = this save_current_group = 1 }}">{{this.name}}</a></li>
            {{/each}}
          </ul>
        </div>
      </div>
    {{/if}}
    <div class="form-group team-view-months">
      <label class="control-label">{{t "teamView.monthsLabel"}}</label>
      <div class="btn-group btn-group-sm team-view-months-buttons" role="group">
        <a href="/calendar/teamview/?{{> team_view_url_parameters months_count = 1 save_months = 1 }}" class="btn btn-default" {{#if_equal months_count 1}}disabled=disabled{{/if_equal}}>1</a>
        <a href="/calendar/teamview/?{{> team_view_url_parameters months_count = 3 save_months = 1 }}" class="btn btn-default" {{#if_equal months_count 3}}disabled=disabled{{/if_equal}}>3</a>
        <a href="/calendar/teamview/?{{> team_view_url_parameters months_count = 6 save_months = 1 }}" class="btn btn-default" {{#if_equal months_count 6}}disabled=disabled{{/if_equal}}>6</a>
        <a href="/calendar/teamview/?{{> team_view_url_parameters months_count = 12 save_months = 1 }}" class="btn btn-default" {{#if_equal months_count 12}}disabled=disabled{{/if_equal}}>12</a>
      </div>
    </div>
  </div>
</div>

<div class="row">&nbsp;</div>

{{#each months}}
  {{#if ../show_month_title}}
  <div class="row clearfix">
    <div class="col-md-12 team-view-table-container">
      <h3>{{as_date_formatted this.start_date 'MMMM, YYYY'}}</h3>
    </div>
  </div>
  {{/if}}

  {{#each this.departments}}
  <div class="row clearfix">
    <div class="col-md-12 team-view-table-container">
      <table class="team-view-table table-hover">
        <thead>
        <tr>
          <td class="team-view-header" colspan="2">
            <div class="pull-left">
              <h3>{{this.departmentName}}</h3>
            </div>
          </td>

        {{#each this.header_days }}
          <td colspan="2" class="team-view-header">
            <div class="team-view-weekday">{{as_date_formatted this.moment 'ddd'}}</div>
          </td>
        {{/each}}
        </tr>
        </thead>

        <tbody>
        {{#each this.users_and_leaves}}
          <tr class="teamview-user-list-row" data-vpp-user-list-row={{this.user.id}}>
            <td class="left-column-cell cross-link user-details-summary-trigger" data-user-id={{this.user.id}}>{{#if ../../../logged_user.admin}} {{#with this.user }}<a href="/users/edit/{{this.id}}/">{{ this.full_name }}</a>{{/with}}{{else}}{{#with this.user }}<span>{{ this.full_name }}</span>{{/with}}{{/if}}</td>
            <td>
              <span class="teamview-deducted-days"
                {{#if statistics }}
                data-content="{{t 'teamView.deductedDays' period=../../../deducted_period name=(full_name this.user) days=../../../statistics.deducted_days }}"
                data-placement="right"
                data-toggle="popover"
                data-trigger="focus hover"
                {{/if}}
              >
              {{#if statistics }}{{ statistics.deducted_days }}{{/if}}
              </span>
            </td>
            {{#each this.days}}
              {{> calendar_cell day = this}}
            {{/each}}
          </tr>
        {{/each}}
        </tbody>
      </table>
    </div>
  </div>
  {{/each}}
{{/each}}

<div class="row clearfix">&nbsp;</div>

{{> footer }}
